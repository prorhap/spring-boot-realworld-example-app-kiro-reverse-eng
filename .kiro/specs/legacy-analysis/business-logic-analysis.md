# 비즈니스 로직 심층 분석

## 개요

이 문서는 RealWorld 플랫폼의 핵심 비즈니스 로직을 결정 테이블 형식으로 분석합니다. 복잡한 조건 분기와 비즈니스 규칙을 평면화하여 Product Owner, 개발자, 비즈니스 분석가, 도메인 전문가가 함께 검토할 수 있도록 정리했습니다.

---

## 로직 1: 회원 정보 수정 시 고유성 검증

**비즈니스 맥락**: 회원이 자신의 프로필 정보를 수정할 때, 이메일과 사용자명은 플랫폼 전체에서 유일해야 합니다. 단, 자신의 기존 값으로 변경하는 것은 허용됩니다.

**소스 위치**: `UpdateUserValidator.isValid()`

### 결정 테이블

| 규칙 ID | 조건 1: 입력된 이메일 | 조건 2: 이메일 소유자 | 조건 3: 입력된 사용자명 | 조건 4: 사용자명 소유자 | 결과: 검증 결과 | 결과: 오류 메시지 | 비고 |
|---------|---------------------|---------------------|----------------------|----------------------|----------------|------------------|------|
| R1 | 제공되지 않음 | - | 제공되지 않음 | - | 성공 | 없음 | 아무것도 변경하지 않는 경우 |
| R2 | 기존 이메일과 동일 | 본인 | 기존 사용자명과 동일 | 본인 | 성공 | 없음 | 자신의 값으로 재설정 |
| R3 | 기존 이메일과 동일 | 본인 | 새로운 사용자명 | 사용 중이지 않음 | 성공 | 없음 | 사용자명만 변경 |
| R4 | 새로운 이메일 | 사용 중이지 않음 | 기존 사용자명과 동일 | 본인 | 성공 | 없음 | 이메일만 변경 |
| R5 | 새로운 이메일 | 사용 중이지 않음 | 새로운 사용자명 | 사용 중이지 않음 | 성공 | 없음 | 둘 다 변경 |
| R6 | 새로운 이메일 | 다른 회원이 사용 중 | 기존 사용자명과 동일 | 본인 | 실패 | "email already exist" | 이메일 중복 |
| R7 | 기존 이메일과 동일 | 본인 | 새로운 사용자명 | 다른 회원이 사용 중 | 실패 | "username already exist" | 사용자명 중복 |
| R8 | 새로운 이메일 | 다른 회원이 사용 중 | 새로운 사용자명 | 다른 회원이 사용 중 | 실패 | "email already exist"<br/>"username already exist" | 둘 다 중복 |
| R9 | 새로운 이메일 | 사용 중이지 않음 | 새로운 사용자명 | 다른 회원이 사용 중 | 실패 | "username already exist" | 사용자명만 중복 |
| R10 | 새로운 이메일 | 다른 회원이 사용 중 | 새로운 사용자명 | 사용 중이지 않음 | 실패 | "email already exist" | 이메일만 중복 |

### 비즈니스 규칙 요약

1. **자기 소유 허용**: 회원은 자신의 현재 이메일이나 사용자명으로 다시 설정할 수 있음
2. **부분 수정 지원**: 이메일만, 사용자명만, 또는 둘 다 변경 가능
3. **즉시 검증**: 수정 요청 시점에 중복 여부를 즉시 확인
4. **명확한 오류**: 어떤 필드가 중복인지 구체적으로 알려줌

### 발견된 이슈

**없음** - 로직이 명확하고 모든 경우를 적절히 처리함

---

## 로직 2: 콘텐츠 수정/삭제 권한 검증

**비즈니스 맥락**: 플랫폼에서 콘텐츠를 수정하거나 삭제할 수 있는 권한은 명확한 규칙에 따라 결정됩니다.

**소스 위치**: `AuthorizationService`

### 결정 테이블 2-1: 기사 수정/삭제 권한

| 규칙 ID | 조건 1: 요청자 | 조건 2: 기사 저자 | 결과: 권한 부여 | 비고 |
|---------|---------------|------------------|----------------|------|
| R1 | 기사 저자 본인 | 요청자와 동일 | 허용 | 저자는 자신의 기사를 수정/삭제 가능 |
| R2 | 다른 회원 | 요청자와 다름 | 거부 | 다른 사람의 기사는 수정/삭제 불가 |
| R3 | 비로그인 사용자 | - | 거부 | 인증되지 않은 사용자는 불가 |

### 결정 테이블 2-2: 댓글 삭제 권한

| 규칙 ID | 조건 1: 요청자 | 조건 2: 댓글 작성자 | 조건 3: 기사 저자 | 결과: 권한 부여 | 비고 |
|---------|---------------|-------------------|------------------|----------------|------|
| R1 | 댓글 작성자 본인 | 요청자와 동일 | - | 허용 | 작성자는 자신의 댓글 삭제 가능 |
| R2 | 기사 저자 | 요청자와 다름 | 요청자와 동일 | 허용 | 기사 저자는 자신의 기사에 달린 모든 댓글 삭제 가능 |
| R3 | 다른 회원 | 요청자와 다름 | 요청자와 다름 | 거부 | 관련 없는 회원은 삭제 불가 |
| R4 | 비로그인 사용자 | - | - | 거부 | 인증되지 않은 사용자는 불가 |

### 비즈니스 규칙 요약

1. **소유권 원칙**: 콘텐츠는 작성자만 수정/삭제 가능
2. **기사 저자의 특권**: 기사 저자는 자신의 기사에 달린 모든 댓글을 삭제할 수 있음 (커뮤니티 관리)
3. **댓글 수정 불가**: 댓글은 수정 기능이 없음 (삭제만 가능)
4. **인증 필수**: 모든 수정/삭제 작업은 로그인 필요

### 발견된 이슈

**잠재적 개선 사항**:
- **관리자 권한 부재**: 플랫폼 관리자가 부적절한 콘텐츠를 삭제할 수 있는 권한이 없음
- **신고 기능 부재**: 부적절한 콘텐츠를 신고하는 메커니즘이 없음
- **댓글 수정 불가**: 오타 수정 등을 위한 댓글 수정 기능이 없어 사용자 경험이 제한적

---

## 로직 3: 부분 정보 수정 (Partial Update)

**비즈니스 맥락**: 회원이나 기사 정보를 수정할 때, 변경하고 싶은 항목만 제공하면 해당 항목만 업데이트되고 나머지는 기존 값을 유지합니다.

**소스 위치**: `User.update()`, `Article.update()`

### 결정 테이블 3-1: 회원 정보 부분 수정

| 규칙 ID | 조건 1: 이메일 제공 | 조건 2: 사용자명 제공 | 조건 3: 비밀번호 제공 | 조건 4: 자기소개 제공 | 조건 5: 프로필 사진 제공 | 결과: 이메일 | 결과: 사용자명 | 결과: 비밀번호 | 결과: 자기소개 | 결과: 프로필 사진 | 비고 |
|---------|-------------------|---------------------|---------------------|---------------------|------------------------|------------|------------|------------|------------|---------------|------|
| R1 | 제공됨 (비어있지 않음) | 제공됨 | 제공됨 | 제공됨 | 제공됨 | 새 값으로 변경 | 새 값으로 변경 | 새 값으로 변경 | 새 값으로 변경 | 새 값으로 변경 | 모든 정보 변경 |
| R2 | 제공됨 | 미제공 (null 또는 빈 문자열) | 미제공 | 미제공 | 미제공 | 새 값으로 변경 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 이메일만 변경 |
| R3 | 미제공 | 제공됨 | 미제공 | 미제공 | 미제공 | 기존 값 유지 | 새 값으로 변경 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 사용자명만 변경 |
| R4 | 미제공 | 미제공 | 제공됨 | 미제공 | 미제공 | 기존 값 유지 | 기존 값 유지 | 새 값으로 변경 | 기존 값 유지 | 기존 값 유지 | 비밀번호만 변경 |
| R5 | 미제공 | 미제공 | 미제공 | 제공됨 | 미제공 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 새 값으로 변경 | 기존 값 유지 | 자기소개만 변경 |
| R6 | 미제공 | 미제공 | 미제공 | 미제공 | 제공됨 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 새 값으로 변경 | 프로필 사진만 변경 |
| R7 | 미제공 | 미제공 | 미제공 | 미제공 | 미제공 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 아무것도 변경 안 함 |
| R8 | 제공됨 | 제공됨 | 미제공 | 미제공 | 미제공 | 새 값으로 변경 | 새 값으로 변경 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 이메일+사용자명 변경 |

### 결정 테이블 3-2: 기사 정보 부분 수정

| 규칙 ID | 조건 1: 제목 제공 | 조건 2: 설명 제공 | 조건 3: 본문 제공 | 결과: 제목 | 결과: 슬러그 | 결과: 설명 | 결과: 본문 | 결과: 수정 시각 | 비고 |
|---------|-----------------|-----------------|-----------------|----------|-----------|----------|----------|---------------|------|
| R1 | 제공됨 (비어있지 않음) | 제공됨 | 제공됨 | 새 값으로 변경 | 제목에서 자동 생성 | 새 값으로 변경 | 새 값으로 변경 | 현재 시각으로 갱신 | 모든 정보 변경 |
| R2 | 제공됨 | 미제공 (null 또는 빈 문자열) | 미제공 | 새 값으로 변경 | 제목에서 자동 생성 | 기존 값 유지 | 기존 값 유지 | 현재 시각으로 갱신 | 제목만 변경 (슬러그도 변경됨) |
| R3 | 미제공 | 제공됨 | 미제공 | 기존 값 유지 | 기존 값 유지 | 새 값으로 변경 | 기존 값 유지 | 현재 시각으로 갱신 | 설명만 변경 |
| R4 | 미제공 | 미제공 | 제공됨 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 새 값으로 변경 | 현재 시각으로 갱신 | 본문만 변경 |
| R5 | 미제공 | 미제공 | 미제공 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 기존 값 유지 | 아무것도 변경 안 함 |
| R6 | 제공됨 | 제공됨 | 미제공 | 새 값으로 변경 | 제목에서 자동 생성 | 새 값으로 변경 | 기존 값 유지 | 현재 시각으로 갱신 | 제목+설명 변경 |
| R7 | 제공됨 | 미제공 | 제공됨 | 새 값으로 변경 | 제목에서 자동 생성 | 기존 값 유지 | 새 값으로 변경 | 현재 시각으로 갱신 | 제목+본문 변경 |
| R8 | 미제공 | 제공됨 | 제공됨 | 기존 값 유지 | 기존 값 유지 | 새 값으로 변경 | 새 값으로 변경 | 현재 시각으로 갱신 | 설명+본문 변경 |

### 비즈니스 규칙 요약

1. **선택적 수정**: 변경하고 싶은 항목만 제공하면 됨
2. **기존 값 보존**: 제공되지 않은 항목은 자동으로 기존 값 유지
3. **빈 값 처리**: null 또는 빈 문자열("")은 "제공되지 않음"으로 간주
4. **자동 갱신**: 기사 수정 시 수정 시각이 자동으로 현재 시각으로 갱신됨
5. **슬러그 동기화**: 제목을 변경하면 슬러그도 자동으로 재생성됨

### 발견된 이슈

**잠재적 문제**:
- **빈 값 초기화 불가**: 현재 로직으로는 필드를 의도적으로 빈 값으로 설정할 수 없음
  - 예: 자기소개를 삭제하고 싶어도 빈 문자열을 보내면 무시됨
  - 비즈니스 요구사항: 자기소개나 프로필 사진을 삭제할 수 있어야 하는가?
- **제목 변경 시 슬러그 변경**: 제목을 수정하면 슬러그(URL)가 변경되어 기존 링크가 깨질 수 있음
  - 비즈니스 요구사항: 슬러그는 불변으로 유지해야 하는가?
  - 대안: 슬러그는 최초 생성 시에만 설정하고 이후 변경 불가
- **수정 시각 갱신 조건**: 아무것도 변경하지 않아도 API를 호출하면 수정 시각이 갱신되는가?
  - 현재 코드: 실제로 값이 변경될 때만 수정 시각 갱신
  - 명확함: 로직이 올바르게 구현됨

---

## 추가 분석이 필요한 영역

### 1. 팔로우/언팔로우 로직
- **현재 상태**: 단순한 관계 생성/삭제
- **잠재적 복잡성**: 자기 자신을 팔로우하는 경우 방지 로직 부재
- **비즈니스 질문**: 회원이 자신을 팔로우할 수 있는가?

### 2. 좋아요 중복 처리
- **현재 상태**: 중복 좋아요 시 데이터베이스 제약 조건에 의존
- **잠재적 개선**: 애플리케이션 레벨에서 명시적으로 처리
- **비즈니스 질문**: 이미 좋아요한 기사에 다시 좋아요를 누르면 어떻게 되는가?

### 3. 슬러그 생성 규칙
- **현재 로직**: 제목을 소문자로 변환하고 특수문자를 하이픈으로 치환
- **잠재적 문제**: 동일한 제목의 기사가 여러 개 있을 경우 슬러그 충돌
- **비즈니스 질문**: 슬러그 충돌을 어떻게 해결하는가?

---

## 다음 단계

다음 분석 단계에서는 주요 비즈니스 프로세스를 엔드투엔드로 시각화합니다:

1. **사용자 여정 흐름도**: 회원 가입부터 기사 발행, 커뮤니티 참여까지의 전체 흐름
2. **비즈니스 프로세스 다이어그램**: 각 바운디드 컨텍스트 간의 상호작용 시각화
